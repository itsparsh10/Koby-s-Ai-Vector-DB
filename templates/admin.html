<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <!-- Add Chart.js for visualizations -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --primary: #00AEEF; /* Vibrant Blue-Turquoise */
      --primary-dark: #0095cc; /* Darker shade of primary */
      --background: #f8f9fa;
      --card-bg: #ffffff;
      --text-dark: #333333; /* Dark Charcoal */
      --text-light: #666666;
      --success: #10b981;
      --danger: #ef4444;
      --border-radius: 12px;
      --card-shadow: 0 2px 10px rgba(0, 0, 0, 0.04);
      --heading-font: 'Poppins', sans-serif;
      --body-font: 'Inter', sans-serif;
    }
    
    /* Import modern fonts for a more professional look */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Inter:wght@400;500;600;700&display=swap');

    body {
      font-family: "Poppins", "Inter", "Helvetica Neue", Arial, sans-serif;
      background: var(--background);
      margin: 0;
      padding: 0;
      color: var(--text-dark);
      line-height: 1.5;
      letter-spacing: 0.01em;
    }

    header {
      background: var(--primary);
      color: #fff;
      padding: 22px 30px;
      font-size: 24px;
      font-weight: 700;
      letter-spacing: 0.5px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      font-family: 'Poppins', sans-serif;
    }
    
    .header-actions {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .logout-btn {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      font-family: 'Poppins', sans-serif;
      letter-spacing: 0.02em;
    }
    
    .logout-btn:hover {
      background: rgba(255, 255, 255, 0.25);
      border-color: rgba(255, 255, 255, 0.3);
      transform: translateY(-1px);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
    }
    
    .logout-btn:active {
      transform: translateY(0);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    .home-btn {
      background: rgba(255, 255, 255, 0.15);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      font-family: 'Poppins', sans-serif;
      letter-spacing: 0.02em;
    }
    
    .home-btn:hover {
      background: rgba(255, 255, 255, 0.25);
      border-color: rgba(255, 255, 255, 0.3);
      transform: translateY(-1px);
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
    }
    
    .home-btn:active {
      transform: translateY(0);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    /* Removed header emoji */

    .container {
      padding: 40px;
      max-width: 1200px;
      margin: auto;
    }
    
    .create-btn {
      background: white;
      color: var(--text-dark);
      padding: 10px 20px;
      border-radius: 30px;
      font-weight: 500;
      font-size: 15px;
      border: none;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    /* Top Stats Cards */
    .cards {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 20px;
      margin-bottom: 35px;
    }
    
    /* Responsive design for smaller screens */
    @media (max-width: 1200px) {
      .cards {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    @media (max-width: 768px) {
      .cards {
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
      }
    }
    
    @media (max-width: 480px) {
      .cards {
        grid-template-columns: 1fr;
        gap: 15px;
      }
    }

    .card {
      background: var(--card-bg);
      padding: 30px 25px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      position: relative;
      overflow: hidden;
      text-align: center;
      border: 1px solid rgba(0, 0, 0, 0.05);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .card:hover {
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
      transform: translateY(-2px);
    }

    .card h3 {
      margin: 0;
      font-size: 16px;
      color: var(--text-dark);
      font-weight: 500;
      text-align: center;
      margin-bottom: 10px;
      font-family: 'Poppins', sans-serif;
      letter-spacing: 0.03em;
    }

    .card p {
      margin: 0;
      font-size: 38px;
      font-weight: 700;
      color: #00AEEF; /* Blue number to match image */
      text-align: center;
      font-family: 'Poppins', sans-serif;
      margin-top: 5px;
    }
    
    .card .completed {
      font-size: 14px;
      color: var(--text-light);
      text-align: left;
    }
    
    .card .completed.green {
      color: var(--success);
    }
    
    .card-icon {
      position: absolute;
      top: 15px;
      right: 15px;
      width: 30px;
      height: 30px;
      background-color: rgba(0, 174, 239, 0.1);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
      font-size: 16px;
    }

    /* Section Containers */
    .section {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--card-shadow);
      padding: 25px;
      margin-bottom: 30px;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(0,0,0,0.04);
    }

    .section-header h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      color: var(--text-dark);
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: 'Poppins', sans-serif;
      letter-spacing: 0.02em;
    }

    .btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
      font-weight: 500;
      font-family: 'Poppins', sans-serif;
      letter-spacing: 0.02em;
    }

    .btn:hover {
      background: var(--primary-dark);
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
    }

    .btn-danger {
      background: var(--danger);
    }

    .btn-danger:hover {
      background: #dc2626;
    }
    
    .btn-success {
      background: #10b981;
    }
    
    .btn-success:hover {
      background: #059669;
    }
    
    .btn-sm {
      padding: 5px 10px;
      font-size: 12px;
    }
    
    .auto-refresh-active {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.6; }
      100% { opacity: 1; }
    }
    
    .highlight-change {
      animation: highlight 2s ease-out;
    }
    
    @keyframes highlight {
      0% { background-color: rgba(16, 185, 129, 0.2); }
      100% { background-color: transparent; }
    }

    /* Stat Cards inside Live Stats */
    .live-users-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 20px;
    }

    .stat-card {
      background: var(--card-bg);
      color: var(--text-dark);
      padding: 30px 20px;
      border-radius: 10px;
      text-align: center;
      box-shadow: var(--card-shadow);
      border: 1px solid rgba(0, 0, 0, 0.05);
      transition: transform 0.2s;
    }
    
    .stat-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.08);
    }

    .stat-card h4 {
      margin: 0 0 10px 0;
      font-size: 15px;
      color: var(--text-light);
      font-weight: 500;
      font-family: 'Poppins', sans-serif;
      letter-spacing: 0.02em;
    }

    .stat-card .number {
      font-size: 36px;
      font-weight: 700;
      color: var(--text-dark);
      margin: 0;
      font-family: 'Poppins', sans-serif;
    }
    
    /* Live User Statistics specific styling */
    .live-stats-header {
      display: flex;
      align-items: center;
      gap: 10px;
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
    }
    
    .live-stats-header svg, 
    .live-stats-header img {
      height: 20px;
      width: 20px;
    }
    
    .refresh-btn {
      background-color: #4ade80;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background-color 0.3s;
      display: flex;
      align-items: center;
      gap: 5px;
      font-family: 'Poppins', sans-serif;
      letter-spacing: 0.02em;
    }
    
    .refresh-btn:hover {
      background-color: #22c55e;
    }
    
    .refresh-btn.refreshing svg {
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Table */
    .sessions-table-container {
      overflow-x: auto;
      border-radius: var(--border-radius);
    }

    .sessions-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      background: var(--card-bg);
    }

    .sessions-table th,
    .sessions-table td {
      padding: 14px 16px;
      text-align: left;
      border-bottom: 1px solid #edf2f7;
      vertical-align: middle;
    }

    .sessions-table td:nth-child(3) {
      text-align: center;
    }

    .sessions-table td:nth-child(7) {
      text-align: center;
    }

    .sessions-table th {
      color: var(--text-light);
      font-weight: 600;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.7px;
      font-family: 'Poppins', sans-serif;
      vertical-align: middle;
    }

    .sessions-table th:nth-child(3),
    .sessions-table th:nth-child(7) {
      text-align: center;
    }
    
    .sessions-table tbody tr:last-child td {
      border-bottom: none;
    }

    .sessions-table tr:hover {
      background: #f9fafc;
      transform: translateY(-1px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      transition: all 0.2s ease;
    }

    .sessions-table tr {
      transition: all 0.2s ease;
    }
    
    .table-container {
      margin-top: 20px;
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      border: 1px solid rgba(0, 0, 0, 0.05);
      background: var(--card-bg);
    }

    .status-active {
      color: #059669;
      font-weight: 600;
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.08));
      padding: 8px 14px;
      border-radius: 20px;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 1px solid rgba(16, 185, 129, 0.2);
      box-shadow: 0 2px 4px rgba(16, 185, 129, 0.1);
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      min-width: 80px;
      justify-content: center;
    }

    .status-active:hover {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.12));
      box-shadow: 0 3px 6px rgba(16, 185, 129, 0.15);
      transform: translateY(-1px);
    }

    .status-active::before {
      content: "‚óè";
      color: #10b981;
      font-size: 8px;
      animation: pulse-dot 2s infinite;
    }

    .status-inactive {
      color: #dc2626;
      font-weight: 600;
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.08));
      padding: 8px 14px;
      border-radius: 20px;
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 1px solid rgba(239, 68, 68, 0.2);
      box-shadow: 0 2px 4px rgba(239, 68, 68, 0.1);
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      min-width: 80px;
      justify-content: center;
    }

    .status-inactive:hover {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.12));
      box-shadow: 0 3px 6px rgba(239, 68, 68, 0.15);
      transform: translateY(-1px);
    }

    .status-inactive::before {
      content: "‚óè";
      color: #ef4444;
      font-size: 8px;
    }

    @keyframes pulse-dot {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .priority-tag {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 30px;
      font-size: 12px;
      font-weight: 500;
      background-color: rgba(0, 174, 239, 0.1);
      color: var(--primary);
    }

    /* Pagination */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      margin-top: 20px;
      padding: 15px;
    }

    .pagination button {
      background: white;
      color: var(--text-dark);
      border: 1px solid #edf2f7;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
      font-weight: 500;
    }
    
    .pagination button:not(:disabled):hover {
      background: #f9fafc;
      border-color: #cad5e0;
    }

    .pagination button:disabled {
      background: #f1f5f9;
      color: #9ca3af;
      border-color: #edf2f7;
      cursor: not-allowed;
    }
    
    .pagination span {
      color: var(--text-dark);
      font-weight: 500;
      font-size: 14px;
    }

    /* Tabs */
    .tabs {
      margin-top: 30px;
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--card-shadow);
      overflow: hidden;
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .tab-buttons {
      display: flex;
      border-bottom: 1px solid #edf2f7;
    }

    .tab-buttons button {
      flex: 1;
      padding: 16px;
      border: none;
      background: white;
      font-size: 15px;
      cursor: pointer;
      transition: 0.2s;
      position: relative;
      color: var(--text-light);
      font-weight: 500;
      font-family: 'Poppins', sans-serif;
    }

    .tab-buttons button.active {
      color: var(--primary);
      font-weight: 600;
    }
    
    .tab-buttons button.active::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background-color: var(--primary);
    }

    .tab-content {
      padding: 25px;
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .user-item {
      background: #f9fafb;
      padding: 16px;
      margin-bottom: 12px;
      border-radius: 10px;
      font-size: 14px;
      border: 1px solid rgba(0,0,0,0.03);
      transition: transform 0.2s;
    }
    
    .user-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.04);
    }

    .user-item strong {
      color: var(--primary);
    }
    

    
    /* Add some styles for empty states */
    .empty-state {
      text-align: center;
      padding: 30px;
      color: var(--text-light);
    }
    
    .empty-state svg {
      width: 60px;
      height: 60px;
      margin-bottom: 15px;
      color: #cbd5e0;
    }
    
    .empty-state h4 {
      margin-bottom: 10px;
      color: var(--text-dark);
    }
    
    /* Session info styles */
    .session-info {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .session-info .device {
      color: var(--text-light);
      font-size: 12px;
    }



    /* Analytics Section */
    .analytics-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .chart-container {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--card-shadow);
      padding: 20px;
      border: 1px solid rgba(0, 0, 0, 0.05);
      height: 300px;
    }
    
    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    
    .chart-header h3 {
      margin: 0;
      font-size: 16px;
      color: var(--text-dark);
      font-weight: 600;
      font-family: 'Poppins', sans-serif;
    }
    
    .chart-actions {
      display: flex;
      gap: 10px;
    }
    
    .chart-select {
      padding: 5px 10px;
      border-radius: 6px;
      border: 1px solid #edf2f7;
      font-size: 13px;
      font-family: 'Inter', sans-serif;
    }
    
    /* User Management Styles */
    .user-management-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .user-management-header h3 {
      margin: 0;
    }
    
    .user-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .user-table th,
    .user-table td {
      padding: 12px 16px;
      text-align: left;
      border-bottom: 1px solid #edf2f7;
    }
    
    .user-table th {
      color: var(--text-light);
      font-weight: 600;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.7px;
    }
    
    .user-actions {
      display: flex;
      gap: 8px;
    }
    
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }
    
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    
    .modal {
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      width: 500px;
      max-width: 90%;
      padding: 25px;
      transform: translateY(-20px);
      transition: transform 0.3s;
    }
    
    .modal-overlay.active .modal {
      transform: translateY(0);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .modal-header h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      font-family: 'Poppins', sans-serif;
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: var(--text-light);
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      font-size: 14px;
      color: var(--text-dark);
    }
    
    .form-control {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      font-size: 14px;
      font-family: 'Inter', sans-serif;
    }
    
    .form-footer {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
    }
    
    /* Export buttons */
    .export-btn {
      background-color: #4ade80;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background-color 0.3s;
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .export-btn:hover {
      background-color: #22c55e;
    }
    
    /* Feedback Approval Styles */
    .feedback-item {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--card-shadow);
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid rgba(0, 0, 0, 0.05);
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .feedback-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.08);
    }
    
    .feedback-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .feedback-meta {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .feedback-user {
      font-weight: 600;
      color: var(--primary);
      font-size: 14px;
    }
    
    .feedback-timestamp {
      font-size: 12px;
      color: var(--text-light);
    }
    
    .feedback-type {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .feedback-type.enhancement {
      background-color: rgba(59, 130, 246, 0.1);
      color: #3b82f6;
    }
    
    .feedback-type.correction {
      background-color: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }
    
    .feedback-type.clarification {
      background-color: rgba(16, 185, 129, 0.1);
      color: #10b981;
    }
    
    .feedback-question {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      border-left: 4px solid var(--primary);
    }
    
    .feedback-question h4 {
      margin: 0 0 8px 0;
      font-size: 14px;
      color: var(--text-dark);
      font-weight: 600;
    }
    
    .feedback-question p {
      margin: 0;
      font-size: 14px;
      color: var(--text-dark);
      line-height: 1.5;
    }
    
    .feedback-answer {
      background: #f0f9ff;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      border-left: 4px solid #0ea5e9;
    }
    
    .feedback-answer h4 {
      margin: 0 0 8px 0;
      font-size: 14px;
      color: var(--text-dark);
      font-weight: 600;
    }
    
    .feedback-answer p {
      margin: 0;
      font-size: 14px;
      color: var(--text-dark);
      line-height: 1.5;
    }
    
    .feedback-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }
    
    .feedback-actions .btn {
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 500;
    }
    
    .feedback-actions .btn-approve {
      background: #10b981;
      color: white;
    }
    
    .feedback-actions .btn-approve:hover {
      background: #059669;
    }
    
    .feedback-actions .btn-reject {
      background: #ef4444;
      color: white;
    }
    
    .feedback-actions .btn-reject:hover {
      background: #dc2626;
    }
    
    .feedback-empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-light);
    }
    
    .feedback-empty-state svg {
      width: 80px;
      height: 80px;
      margin-bottom: 20px;
      color: #cbd5e0;
    }
    
    .feedback-empty-state h4 {
      margin-bottom: 10px;
      color: var(--text-dark);
      font-size: 18px;
    }
    
    .feedback-empty-state p {
      font-size: 14px;
      line-height: 1.5;
    }
    
    /* Add User Modal Styles */
    .add-user-modal {
      background-color: white;
      border-radius: 12px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      width: 500px;
      max-width: 90%;
      max-height: 90vh;
      padding: 25px;
      transform: translateY(-20px);
      transition: transform 0.3s;
      overflow-y: auto;
      box-sizing: border-box;
    }
    
    .add-user-modal .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #edf2f7;
    }
    
    .add-user-modal .modal-header h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      font-family: 'Poppins', sans-serif;
      color: var(--text-dark);
    }
    
    .add-user-modal .form-group {
      margin-bottom: 20px;
      width: 100%;
      box-sizing: border-box;
    }
    
    .add-user-modal .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      font-size: 14px;
      color: var(--text-dark);
      font-family: 'Poppins', sans-serif;
    }
    
    .add-user-modal .form-control {
      width: 100%;
      padding: 12px 16px;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
      font-size: 14px;
      font-family: 'Inter', sans-serif;
      transition: border-color 0.2s, box-shadow 0.2s;
      box-sizing: border-box;
      margin: 0;
    }
    
    .add-user-modal .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(0, 174, 239, 0.1);
    }
    
    .add-user-modal .role-selector {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 8px;
      width: 100%;
      box-sizing: border-box;
    }
    
    .add-user-modal .role-option {
      padding: 12px 8px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 13px;
      font-weight: 500;
      font-family: 'Poppins', sans-serif;
      box-sizing: border-box;
      min-width: 0;
      overflow: hidden;
    }
    
    .add-user-modal .role-option:hover {
      border-color: var(--primary);
      background-color: rgba(0, 174, 239, 0.05);
    }
    
    .add-user-modal .role-option.selected {
      border-color: var(--primary);
      background-color: var(--primary);
      color: white;
    }
    
    .add-user-modal .role-option.admin {
      border-color: #ef4444;
    }
    
    .add-user-modal .role-option.admin:hover,
    .add-user-modal .role-option.admin.selected {
      background-color: #ef4444;
      border-color: #ef4444;
    }
    
    .add-user-modal .role-option.manager {
      border-color: #f59e0b;
    }
    
    .add-user-modal .role-option.manager:hover,
    .add-user-modal .role-option.manager.selected {
      background-color: #f59e0b;
      border-color: #f59e0b;
    }
    
    .add-user-modal .role-option.user {
      border-color: #10b981;
    }
    
    .add-user-modal .role-option.user:hover,
    .add-user-modal .role-option.user.selected {
      background-color: #10b981;
      border-color: #10b981;
    }
    
    .add-user-modal .form-footer {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 25px;
      padding-top: 20px;
      border-top: 1px solid #edf2f7;
      width: 100%;
      box-sizing: border-box;
    }
    
    .add-user-modal .btn-cancel {
      background: #f1f5f9;
      color: var(--text-dark);
      border: 1px solid #e2e8f0;
    }
    
    .add-user-modal .btn-cancel:hover {
      background: #e2e8f0;
    }
    
    .add-user-modal .btn-create {
      background: var(--primary);
      color: white;
    }
    
    .add-user-modal .btn-create:hover {
      background: var(--primary-dark);
    }
    
    .add-user-modal .btn-create:disabled {
      background: #cbd5e0;
      cursor: not-allowed;
    }
    
    /* Ensure form is properly contained */
    .add-user-modal form {
      width: 100%;
      box-sizing: border-box;
    }
    
    /* Responsive adjustments for smaller screens */
    @media (max-width: 600px) {
      .add-user-modal {
        width: 95%;
        padding: 20px;
        margin: 10px;
      }
      
      .add-user-modal .role-selector {
        grid-template-columns: 1fr;
        gap: 8px;
      }
      
      .add-user-modal .form-footer {
        flex-direction: column;
        gap: 10px;
      }
      
      .add-user-modal .form-footer button {
        width: 100%;
      }
    }
    
    /* Ensure proper spacing and alignment */
    .add-user-modal .modal-header {
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #edf2f7;
      width: 100%;
      box-sizing: border-box;
    }
    
    /* Search highlighting styles */
    mark {
      background-color: #fef3c7 !important;
      color: #92400e !important;
      padding: 2px 4px !important;
      border-radius: 3px !important;
      font-weight: 500 !important;
      border: none !important;
    }
    
    /* Search container improvements */
    .search-container input {
      background: #ffffff !important;
      background-image: none !important;
      background-repeat: no-repeat !important;
      background-size: auto !important;
      background-position: initial !important;
      border: 1px solid #e2e8f0 !important;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
      cursor: text !important;
      -webkit-appearance: none !important;
      -moz-appearance: none !important;
      appearance: none !important;
      border-radius: 25px !important;
      padding: 14px 20px 14px 48px !important;
      font-size: 15px !important;
      font-weight: 400 !important;
      letter-spacing: 0.01em !important;
      color: #374151 !important;
    }
    
    .search-container input:focus {
      border-color: #00AEEF !important;
      box-shadow: 0 0 0 3px rgba(0, 174, 239, 0.1) !important;
      background: #ffffff !important;
      background-image: none !important;
      outline: none !important;
    }
    
    .search-container input::placeholder {
      color: #9ca3af;
      font-style: normal;
      font-weight: 400;
    }
    
    .search-container input:hover {
      border-color: #d1d5db !important;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
    }
    
    /* Override any external styles that might interfere */
    #sessionSearch {
      background: #ffffff !important;
      background-image: none !important;
      background-repeat: no-repeat !important;
      background-size: auto !important;
      background-position: initial !important;
      border: 1px solid #e2e8f0 !important;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
      cursor: text !important;
      -webkit-appearance: none !important;
      -moz-appearance: none !important;
      appearance: none !important;
    }
    
    #sessionSearch:focus {
      border-color: #00AEEF !important;
      box-shadow: 0 0 0 3px rgba(0, 174, 239, 0.1) !important;
      background: #ffffff !important;
      background-image: none !important;
      outline: none !important;
    }
    
    #sessionSearch:hover {
      background: #ffffff !important;
      background-image: none !important;
    }
    
    /* Search button improvements */
    .search-container button {
      transition: all 0.2s ease;
    }
    
    .search-container button:hover {
      transform: translateY(-1px);
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
    }
    
    .search-container button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    /* Clear button hover effect */
    #clearSearchBtn:hover {
      color: #ef4444 !important;
      background-color: #fef2f2 !important;
    }
    
    /* Aggressive override for any external styling */
    input[type="text"]#sessionSearch,
    input[type="search"]#sessionSearch,
    input#sessionSearch {
      background: #ffffff !important;
      background-image: none !important;
      background-repeat: no-repeat !important;
      background-size: auto !important;
      background-position: initial !important;
      border: 1px solid #e2e8f0 !important;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
      cursor: text !important;
      -webkit-appearance: none !important;
      -moz-appearance: none !important;
      appearance: none !important;
      outline: none !important;
      border-radius: 25px !important;
      padding: 14px 20px 14px 48px !important;
      font-size: 15px !important;
      font-weight: 400 !important;
      letter-spacing: 0.01em !important;
      color: #374151 !important;
      width: 350px !important;
    }
    
    input[type="text"]#sessionSearch:focus,
    input[type="search"]#sessionSearch:focus,
    input#sessionSearch:focus {
      border-color: #00AEEF !important;
      box-shadow: 0 0 0 3px rgba(0, 174, 239, 0.1) !important;
      background: #ffffff !important;
      background-image: none !important;
      outline: none !important;
    }
    
    input[type="text"]#sessionSearch:hover,
    input[type="search"]#sessionSearch:hover,
    input#sessionSearch:hover {
      background: #ffffff !important;
      background-image: none !important;
      border-color: #d1d5db !important;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-title" style="font-family: 'Poppins', sans-serif; font-weight: 600;">Dashboard</div>
    <div class="header-actions">
      <button class="home-btn" onclick="goHome()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
          <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
          <polyline points="9,22 9,12 15,12 15,22"></polyline>
        </svg>
        Home
      </button>
      <button class="logout-btn" onclick="logout()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
          <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
          <polyline points="16,17 21,12 16,7"></polyline>
          <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
        Logout
      </button>
    </div>
  </header>



  <div class="container">
    <!-- Stats Cards -->
    <div class="cards">
      <div class="card">
        <div class="card-icon">üë•</div>
        <h3>Live Users</h3>
        <p>0</p>
      </div>
      <div class="card">
        <div class="card-icon">üë§</div>
        <h3>Total Users</h3>
        <p>0</p>
      </div>
      <div class="card">
        <div class="card-icon">üìù</div>
        <h3>Pending Questions</h3>
        <p id="pendingQuestionsCount">0</p>
      </div>
      <div class="card">
        <div class="card-icon">üîë</div>
        <h3>Today's Logins</h3>
        <p>0</p>
      </div>
      <div class="card">
        <div class="card-icon">üìä</div>
        <h3>Total Sessions</h3>
        <p>0</p>
      </div>

    </div>



    <!-- Live User Statistics Section - Hidden from frontend but backend functionality preserved -->
    <div class="section" style="display: none;">
      <div class="section-header">
        <h3 class="live-stats-header">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="8" width="4" height="12" rx="1"></rect>
            <rect x="10" y="4" width="4" height="16" rx="1"></rect>
            <rect x="17" y="12" width="4" height="8" rx="1"></rect>
          </svg>
          Live User Statistics
        </h3>
        <button class="refresh-btn" onclick="refreshDashboardStats()">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 2v6h-6"></path>
            <path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path>
            <path d="M3 22v-6h6"></path>
            <path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
          </svg>
          Refresh
        </button>
      </div>
      <div class="live-users-grid">

        <div class="stat-card" style="background: #6366F1; color: white; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.2);">
          <h4 style="color: rgba(255,255,255,0.8);">Total Sessions</h4>
          <div class="number" style="color: white;" id="totalSessions">2</div>
        </div>

      </div>
    </div>
    
    <!-- Active Projects Section -->
    <div class="section">
      <div class="section-header">
        <h3>User Login Sessions <span id="searchResultCount" style="font-size: 14px; color: #6b7280; font-weight: normal;"></span></h3>
        <div style="display: flex; gap: 10px;">
          <div class="search-container" style="position: relative; display: flex; align-items: center; gap: 8px;">
            <div style="position: relative; display: flex; align-items: center;">
              <!-- Search icon -->
              <div style="position: absolute; left: 16px; z-index: 2; pointer-events: none; color: #6b7280;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="11" cy="11" r="8"></circle>
                  <path d="M21 21l-4.35-4.35"></path>
                </svg>
              </div>
              
              <input type="text" id="sessionSearch" placeholder="Find trending topics" style="
                padding: 14px 20px 14px 48px; 
                padding-right: 50px;
                border-radius: 25px; 
                border: 1px solid #e2e8f0 !important; 
                width: 350px; 
                font-size: 15px; 
                font-family: 'Inter', sans-serif; 
                background: #ffffff !important; 
                background-image: none !important;
                background-repeat: no-repeat !important;
                background-size: auto !important;
                background-position: initial !important;
                color: #374151; 
                outline: none !important; 
                transition: all 0.2s ease;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
                cursor: text !important;
                -webkit-appearance: none !important;
                -moz-appearance: none !important;
                appearance: none !important;
                font-weight: 400;
                letter-spacing: 0.01em;
              " onfocus="this.style.borderColor='#00AEEF'; this.style.boxShadow='0 0 0 3px rgba(0, 174, 239, 0.1)'; this.style.background='#ffffff'; this.style.backgroundImage='none';" onblur="this.style.borderColor='#e2e8f0'; this.style.boxShadow='0 1px 3px rgba(0, 0, 0, 0.1)'; this.style.background='#ffffff'; this.style.backgroundImage='none';" onkeyup="handleSearchInput(event)">
              
              <!-- Clear button -->
              <button type="button" id="clearSearchBtn" onclick="clearSearch()" style="
                position: absolute;
                right: 12px;
                background: none;
                border: none;
                color: #9ca3af;
                cursor: pointer;
                padding: 6px;
                border-radius: 50%;
                display: none;
                transition: all 0.2s ease;
                width: 24px;
                height: 24px;
                display: flex;
                align-items: center;
                justify-content: center;
              " onmouseover="this.style.backgroundColor='#f3f4f6'; this.style.color='#6b7280';" onmouseout="this.style.backgroundColor='transparent'; this.style.color='#9ca3af';">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="18" y1="6" x2="6" y2="18"></line>
                  <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
              </button>
            </div>
            
            <button onclick="searchSessions()" class="btn" style="display: flex; align-items: center; gap: 5px;">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="M21 21l-4.35-4.35"></path>
              </svg>
              Search
            </button>
          </div>
          <select id="statusFilter" onchange="filterByStatus()" style="padding: 8px 12px; border-radius: 6px; border: 1px solid #e2e8f0;">
            <option value="all">All Sessions</option>
            <option value="active">Active Only</option>
            <option value="inactive">Inactive Only</option>
          </select>
          <button class="btn" onclick="refreshUserSessions()">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 5px;">
              <path d="M21 2v6h-6"></path>
              <path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path>
              <path d="M3 22v-6h6"></path>
              <path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
            </svg>
            Refresh
          </button>
        </div>
      </div>
      
      <div class="table-container">
        <table class="sessions-table projects-table">
          <thead>
            <tr>
              <th>User Name</th><th>Email</th><th>Status</th><th>Login Time</th>
              <th>Last Activity</th><th>Session Duration</th><th>Actions</th>
            </tr>
          </thead>
          <tbody id="sessionsTableBody">
            <tr><td colspan="7" style="text-align: center; padding: 30px;">Loading user sessions...</td></tr>
          </tbody>
        </table>
        <div class="pagination">
          <button id="prevBtn" onclick="previousPage()" disabled>‚Üê Previous</button>
          <span id="pageInfo">Page 1 of 1</span>
          <button id="nextBtn" onclick="nextPage()" disabled>Next ‚Üí</button>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs">
      <div class="tab-buttons">
        <button class="tab-btn active" onclick="showTab('newUsers')">New Users</button>
        <button class="tab-btn" onclick="showTab('loggedIn')">Logged-in Users</button>
        <button class="tab-btn" onclick="showTab('feedbackApproval')">Feedback Approval <span id="pendingCount" style="background: #ef4444; color: white; border-radius: 10px; padding: 2px 6px; font-size: 11px; margin-left: 5px;">0</span></button>
      </div>
      <div id="newUsers" class="tab-content active">
        <div class="section-header">
          <h4>Newly Registered Users</h4>
          <button class="btn" onclick="openAddUserModal()" style="display: flex; align-items: center; gap: 5px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
              <circle cx="8.5" cy="7" r="4"></circle>
              <line x1="20" y1="8" x2="20" y2="14"></line>
              <line x1="23" y1="11" x2="17" y2="11"></line>
            </svg>
            Add User
          </button>
        </div>
        <p>Total New Users: <span id="newUsersCount">35</span></p>
      </div>
      <div id="loggedIn" class="tab-content">
        <h4>Currently Logged-in Users</h4>
        <p>Total Logged-in Users: <span id="loggedInCount">85</span></p>
      </div>
      <div id="feedbackApproval" class="tab-content">
        <div class="section-header">
          <h3>Pending Feedback Approval</h3>
          <div id="feedbackActionButtons" style="display: flex; gap: 10px;">
            <button class="btn btn-success" onclick="approveAllPending()">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 5px;">
                <path d="M9 12l2 2 4-4"></path>
                <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                <path d="M13 12h3a2 2 0 0 1 2 2v1"></path>
                <path d="M13 12H9a2 2 0 0 0-2 2v1"></path>
                <path d="M13 12v-2a2 2 0 0 0-2-2H9"></path>
              </svg>
              Approve All
            </button>
            <button class="btn" onclick="refreshPendingFeedback()">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 5px;">
                <path d="M21 2v6h-6"></path>
                <path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path>
                <path d="M3 22v-6h6"></path>
                <path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
              </svg>
              Refresh
            </button>
          </div>
        </div>
        
        <div id="pendingFeedbackContainer">
          <div style="text-align: center; padding: 30px;">
            Loading pending feedback...
          </div>
        </div>
      </div>
    </div>


  </div>

  <!-- Add User Modal -->
  <div id="addUserModal" class="modal-overlay">
    <div class="add-user-modal">
      <div class="modal-header">
        <h3>Add New User</h3>
        <button class="modal-close" onclick="closeAddUserModal()">&times;</button>
      </div>
      
      <form id="addUserForm">
        <div class="form-group">
          <label for="userName">Full Name *</label>
          <input type="text" id="userName" class="form-control" placeholder="Enter full name" required>
        </div>
        
        <div class="form-group">
          <label for="userEmail">Email Address *</label>
          <input type="email" id="userEmail" class="form-control" placeholder="Enter email address" required>
        </div>
        
        <div class="form-group">
          <label for="userPassword">Password *</label>
          <input type="password" id="userPassword" class="form-control" placeholder="Enter password" required>
        </div>
        
        <div class="form-group">
          <label>User Role *</label>
          <div class="role-selector">
            <div class="role-option admin" data-role="admin" onclick="selectRole('admin')">
              <div style="font-weight: 600; margin-bottom: 4px;">Admin</div>
              <div style="font-size: 11px; opacity: 0.8;">Full Access</div>
            </div>
            <div class="role-option manager" data-role="manager" onclick="selectRole('manager')">
              <div style="font-weight: 600; margin-bottom: 4px;">Manager</div>
              <div style="font-size: 11px; opacity: 0.8;">Limited Access</div>
            </div>
            <div class="role-option user selected" data-role="user" onclick="selectRole('user')">
              <div style="font-weight: 600; margin-bottom: 4px;">User</div>
              <div style="font-size: 11px; opacity: 0.8;">Basic Access</div>
            </div>
          </div>
        </div>
        
        <div class="form-footer">
          <button type="button" class="btn btn-cancel" onclick="closeAddUserModal()">Cancel</button>
          <button type="submit" class="btn btn-create" id="createUserBtn">Create User</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Helper function to format dates nicely
    function formatDateTime(dateString) {
      if (!dateString) return 'N/A';
      
      const date = new Date(dateString);
      const today = new Date();
      
      // Check if date is today
      if (date.toDateString() === today.toDateString()) {
        return `Today, ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
      }
      
      // Check if date is yesterday
      const yesterday = new Date(today);
      yesterday.setDate(yesterday.getDate() - 1);
      if (date.toDateString() === yesterday.toDateString()) {
        return `Yesterday, ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
      }
      
      // Otherwise, show full date and time
      return `${date.toLocaleDateString()} ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
    }

    // Function to update dashboard stats
    function refreshDashboardStats() {
      // Show refresh animation
      document.querySelector(".refresh-btn").classList.add("refreshing");
      
      // Fetch real dashboard stats from the API
      fetch('/api/auth/dashboard-stats/')
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const stats = data.stats;
            
            // Update top stat cards with real MongoDB data
            document.querySelector('.card:nth-child(1) p').textContent = stats.live_users || 0;
            document.querySelector('.card:nth-child(2) p').textContent = stats.total_users || 0;
            document.getElementById('pendingQuestionsCount').textContent = stats.pending_questions || 0;
            document.querySelector('.card:nth-child(4) p').textContent = stats.today_logins || 0;
            document.querySelector('.card:nth-child(5) p').textContent = stats.total_sessions || 0;
            
            // Update live stats
            document.getElementById("totalSessions").textContent = stats.total_sessions || 0;
            
            // Update tab counters
            document.getElementById("newUsersCount").textContent = stats.recent_users ? stats.recent_users.length : 0;
            document.getElementById("loggedInCount").textContent = stats.logged_in_users ? stats.logged_in_users.length : 0;
            
            // Populate user tabs with MongoDB data
            populateNewUsersTab(stats.recent_users || []);
            populateLoggedInUsersTab(stats.logged_in_users || []);

            console.log("Dashboard stats updated with MongoDB data successfully");
          } else {
            console.error('Error fetching dashboard stats:', data.error);
          }
          
          // Remove refresh animation
          setTimeout(() => {
            document.querySelector(".refresh-btn").classList.remove("refreshing");
          }, 500);
        })
        .catch(error => {
          console.error('Error fetching dashboard stats:', error);
          document.querySelector(".refresh-btn").classList.remove("refreshing");
        });
    }
    
    // Sessions data
    let sessions = [];
    let currentPage = 1;
    const rowsPerPage = 10;
    
    // Function to fetch user sessions from the API
    function fetchUserSessions(page = 1, status = 'all', search = '') {
      const url = `/api/auth/sessions/?page=${page}&per_page=${rowsPerPage}&status=${status}&search=${search}`;
      
      // Show loading state
      const tbody = document.getElementById("sessionsTableBody");
      tbody.innerHTML = `<tr><td colspan="7" style="text-align: center; padding: 30px;">
        Loading user sessions from MongoDB...
      </td></tr>`;
      
      fetch(url)
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          if (data.success) {
            sessions = data.sessions;
            currentPage = data.pagination.page;
            
            // Update real-time info
            if (sessions.length > 0) {
              // Sort sessions by active status (active first)
              sessions.sort((a, b) => {
                if (a.is_active === 'active' && b.is_active !== 'active') return -1;
                if (a.is_active !== 'active' && b.is_active === 'active') return 1;
                return 0;
              });
            }
            
            renderTable();
            updatePagination(data.pagination);
            
            // After getting new session data, refresh the dashboard stats to keep all numbers in sync
            refreshDashboardStats();
          } else {
            console.error('Error fetching sessions:', data.error);
            tbody.innerHTML = `<tr><td colspan="7" class="empty-state">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
              </svg>
              <h4>Error Loading Sessions</h4>
              <p>${data.error || 'An unknown error occurred. Please try again.'}</p>
            </td></tr>`;
          }
        })
        .catch(error => {
          console.error('Error fetching sessions:', error);
          tbody.innerHTML = `<tr><td colspan="7" class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="8" x2="12" y2="12"></line>
              <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
            <h4>Connection Error</h4>
            <p>Could not connect to the MongoDB database. Please check your connection and try again.</p>
          </td></tr>`;
        });
    }

    function renderTable() {
      const tbody = document.getElementById("sessionsTableBody");
      const searchResultCount = document.getElementById("searchResultCount");
      tbody.innerHTML = "";

      // Update search result count
      const searchQuery = document.getElementById('sessionSearch').value.trim();
      const statusFilter = document.getElementById('statusFilter').value;
      
      if (searchQuery) {
        searchResultCount.textContent = `(${sessions.length} results for "${searchQuery}")`;
      } else if (statusFilter !== 'all') {
        searchResultCount.textContent = `(${sessions.length} ${statusFilter} sessions)`;
      } else {
        searchResultCount.textContent = `(${sessions.length} total sessions)`;
      }

      if (sessions.length === 0) {
        let emptyMessage = "No user sessions match your current filters.";
        if (searchQuery) {
          emptyMessage = `No sessions found matching "${searchQuery}". Try a different search term.`;
        } else if (statusFilter !== 'all') {
          emptyMessage = `No ${statusFilter} sessions found.`;
        }
        
        searchResultCount.textContent = "(0 results)";
        
        tbody.innerHTML = `<tr><td colspan="7" class="empty-state">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"></path>
            <path d="M9 10h.01"></path><path d="M15 10h.01"></path>
            <path d="M9.5 15.5c.82.82 2.13.97 3.5 1 1.33-.03 2.67-.18 3.5-1"></path>
          </svg>
          <h4>No Sessions Found</h4>
          <p>${emptyMessage}</p>
        </td></tr>`;
        return;
      }

      const searchQueryLower = searchQuery.toLowerCase();
      
      sessions.forEach(s => {
        // Calculate session duration with better handling of MongoDB data
        let duration = "N/A";
        try {
          if (s.is_active === "active" && s.last_activity && s.login_time) {
            const loginTime = new Date(s.login_time);
            const lastActivity = new Date(s.last_activity);
            
            // Check for valid dates
            if (!isNaN(loginTime) && !isNaN(lastActivity)) {
              const diffMs = lastActivity - loginTime;
              const diffMins = Math.round(diffMs / 60000);
              
              if (diffMins < 60) {
                duration = `${diffMins}m`;
              } else {
                const hours = Math.floor(diffMins / 60);
                const mins = diffMins % 60;
                duration = `${hours}h ${mins}m`;
              }
            }
          } else if (s.logout_time && s.login_time) {
            const loginTime = new Date(s.login_time);
            const logoutTime = new Date(s.logout_time);
            
            // Check for valid dates
            if (!isNaN(loginTime) && !isNaN(logoutTime)) {
              const diffMs = logoutTime - loginTime;
              const diffMins = Math.round(diffMs / 60000);
              
              if (diffMins < 60) {
                duration = `${diffMins}m`;
              } else {
                const hours = Math.floor(diffMins / 60);
                const mins = diffMins % 60;
                duration = `${hours}h ${mins}m`;
              }
            }
          }
        } catch (e) {
          console.error("Error calculating session duration:", e);
          duration = "Error";
        }
        
        // Format dates for display with better error handling
        const loginTime = formatDateTime(s.login_time);
        const lastActivity = s.is_active === "active" ? formatDateTime(s.last_activity) : "N/A";
        
        // Create row with highlight for active sessions
        let rowClass = s.is_active === "active" ? ' style="background-color: rgba(16, 185, 129, 0.05); border-left: 3px solid #10b981;"' : '';
        
        // Highlight search terms in name and email
        const userName = highlightSearchTerm(s.user_name || 'Unknown', searchQueryLower);
        const userEmail = highlightSearchTerm(s.user_email || 'Unknown', searchQueryLower);
        
        let row = `<tr${rowClass}>
          <td>${userName}</td>
          <td>${userEmail}</td>
          <td class="${s.is_active==='active'?'status-active':'status-inactive'}">${s.is_active}</td>
          <td>${loginTime}</td>
          <td>${lastActivity}</td>
          <td>${duration}</td>
          <td>${s.is_active==='active' ? `<button class="btn btn-danger" onclick="endSession('${s.session_key}')">End</button>` : 'Ended'}</td>
        </tr>`;
        tbody.innerHTML += row;
      });
    }

    function highlightSearchTerm(text, searchQuery) {
      if (!searchQuery || searchQuery.length === 0) {
        return text;
      }
      
      // Escape special regex characters in search query
      const escapedQuery = searchQuery.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      const regex = new RegExp(`(${escapedQuery})`, 'gi');
      
      return text.replace(regex, '<mark style="background-color: #fef3c7; color: #92400e; padding: 2px 4px; border-radius: 3px; font-weight: 500;">$1</mark>');
    }

    function updatePagination(pagination) {
      const totalPages = pagination.total_pages;
      document.getElementById("pageInfo").innerText = `Page ${pagination.page} of ${totalPages}`;
      document.getElementById("prevBtn").disabled = pagination.page === 1;
      document.getElementById("nextBtn").disabled = pagination.page === totalPages;
    }

    function previousPage() {
      if (currentPage > 1) {
        fetchUserSessions(currentPage - 1);
      }
    }

    function nextPage() {
      fetchUserSessions(currentPage + 1);
    }

    function endSession(sessionKey) {
      if (!confirm("Are you sure you want to end this session?")) {
        return;
      }
      
      fetch('/api/auth/terminate-session/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          session_key: sessionKey
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Refresh the sessions list
          fetchUserSessions(currentPage);
          // Also refresh the dashboard stats
          refreshDashboardStats();
        } else {
          console.error('Error:', data.error);
        }
      })
      .catch(error => {
        console.error('Error ending session:', error);
      });
    }

    function cleanupOldSessions() {
      if (!confirm("Are you sure you want to clean up all old inactive sessions?")) {
        return;
      }
      
      fetch('/api/auth/cleanup-sessions/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert(`‚úÖ Cleaned up ${data.cleaned_count} old sessions!`);
          // Refresh the sessions list
          fetchUserSessions(1);
          // Also refresh the dashboard stats
          refreshDashboardStats();
        } else {
          alert(`Error: ${data.error || 'Failed to clean up sessions'}`);
        }
      })
      .catch(error => {
        console.error('Error cleaning up sessions:', error);
        alert('Failed to clean up sessions. Please try again.');
      });
    }

    function refreshUserSessions() {
      fetchUserSessions(1);
    }


    
    // Search functionality with debouncing
    let searchTimeout = null;
    let lastSearchQuery = '';
    
    function handleSearchInput(event) {
      const searchInput = document.getElementById('sessionSearch');
      const clearBtn = document.getElementById('clearSearchBtn');
      const searchQuery = searchInput.value.trim();
      
      // Clean up any external styling interference
      cleanSearchInput();
      
      // Show/hide clear button
      if (searchQuery.length > 0) {
        clearBtn.style.display = 'block';
      } else {
        clearBtn.style.display = 'none';
      }
      
      // Clear previous timeout
      if (searchTimeout) {
        clearTimeout(searchTimeout);
      }
      
      // Set new timeout for debounced search
      searchTimeout = setTimeout(() => {
        if (searchQuery !== lastSearchQuery) {
          lastSearchQuery = searchQuery;
          performSearch();
        }
      }, 300); // 300ms debounce
      
      // Handle Enter key
      if (event.key === 'Enter') {
        if (searchTimeout) {
          clearTimeout(searchTimeout);
        }
        performSearch();
      }
    }
    
    function performSearch() {
      const searchQuery = document.getElementById('sessionSearch').value.trim();
      const statusFilter = document.getElementById('statusFilter').value;
      
      // Add visual feedback
      const searchBtn = document.querySelector('.search-container button');
      const originalText = searchBtn.innerHTML;
      searchBtn.disabled = true;
      
      fetchUserSessions(1, statusFilter, searchQuery).finally(() => {
        // Restore button state
        searchBtn.innerHTML = originalText;
        searchBtn.disabled = false;
      });
    }
    
    function searchSessions() {
      performSearch();
    }
    
    function clearSearch() {
      const searchInput = document.getElementById('sessionSearch');
      const clearBtn = document.getElementById('clearSearchBtn');
      
      searchInput.value = '';
      clearBtn.style.display = 'none';
      lastSearchQuery = '';
      
      // Perform search with empty query
      performSearch();
      
      // Focus back to search input
      searchInput.focus();
    }
    
    function filterByStatus() {
      const statusFilter = document.getElementById('statusFilter').value;
      const searchQuery = document.getElementById('sessionSearch').value.trim();
      fetchUserSessions(1, statusFilter, searchQuery);
    }
    
    // Function to populate the new users tab
    function populateNewUsersTab(users) {
      const newUsersTab = document.getElementById("newUsers");
      const contentContainer = newUsersTab.querySelector("p").nextElementSibling || newUsersTab.appendChild(document.createElement("div"));
      
      if (!users || users.length === 0) {
        contentContainer.innerHTML = `<div class="empty-state">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
          <h4>No New Users</h4>
          <p>There are no newly registered users to display.</p>
        </div>`;
        return;
      }
      
      let html = "";
      users.forEach(user => {
        const formattedDate = formatDateTime(user.created_at);
        
        html += `
          <div class="user-item">
            <strong>${user.name}</strong> (${user.email})<br>
            Registered: ${formattedDate}
          </div>
        `;
      });
      
      contentContainer.innerHTML = html;
    }
    
    // Function to populate the logged in users tab with MongoDB data
    function populateLoggedInUsersTab(users) {
      const loggedInTab = document.getElementById("loggedIn");
      const contentContainer = loggedInTab.querySelector("p").nextElementSibling || loggedInTab.appendChild(document.createElement("div"));
      
      if (!users || users.length === 0) {
        contentContainer.innerHTML = `<div class="empty-state">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          </svg>
          <h4>No Active Users</h4>
          <p>There are no users currently logged in.</p>
        </div>`;
        return;
      }
      
      let html = "";
      
      // Sort users by last activity time (most recent first)
      users.sort((a, b) => {
        const timeA = new Date(a.last_activity || a.login_time || 0);
        const timeB = new Date(b.last_activity || b.login_time || 0);
        return timeB - timeA;
      });
      
      users.forEach(user => {
        const loginTime = formatDateTime(user.login_time);
        const lastActivity = formatDateTime(user.last_activity);
        
        // Calculate time since last activity
        let timeSinceLastActivity = '';
        if (user.last_activity) {
          const lastActivityTime = new Date(user.last_activity);
          const now = new Date();
          const diffMs = now - lastActivityTime;
          const diffMins = Math.round(diffMs / 60000);
          
          if (diffMins < 1) {
            timeSinceLastActivity = 'Just now';
          } else if (diffMins < 60) {
            timeSinceLastActivity = `${diffMins} min ago`;
          } else if (diffMins < 1440) {
            const hours = Math.floor(diffMins / 60);
            timeSinceLastActivity = `${hours} hour${hours > 1 ? 's' : ''} ago`;
          } else {
            const days = Math.floor(diffMins / 1440);
            timeSinceLastActivity = `${days} day${days > 1 ? 's' : ''} ago`;
          }
        }
        
        html += `
          <div class="user-item">
            <strong>${user.name}</strong> (${user.email})<br>
            <div style="display: flex; justify-content: space-between; margin-top: 5px;">
              <span>Login: ${loginTime}</span>
              <span>Last Activity: ${lastActivity}</span>
            </div>
            <div style="font-size: 12px; color: #666; margin-top: 5px;">
              Last seen: ${timeSinceLastActivity || 'Unknown'}
            </div>
          </div>
        `;
      });
      
      contentContainer.innerHTML = html;
    }



    // Auto-refresh settings
    let autoRefreshEnabled = true;
    let autoRefreshInterval = 30000; // 30 seconds
    let refreshTimer = null;
    
    function toggleAutoRefresh() {
      autoRefreshEnabled = !autoRefreshEnabled;
      const toggleBtn = document.getElementById('autoRefreshToggle');
      
      if (autoRefreshEnabled) {
        toggleBtn.textContent = 'Disable Auto-Refresh';
        toggleBtn.classList.remove('btn-danger');
        toggleBtn.classList.add('btn-success');
        startAutoRefresh();
      } else {
        toggleBtn.textContent = 'Enable Auto-Refresh';
        toggleBtn.classList.remove('btn-success');
        toggleBtn.classList.add('btn-danger');
        stopAutoRefresh();
      }
    }
    
    // Track previous values to highlight changes
    let previousStats = {
      live_users: 0,
      total_users: 0,
      active_sessions: 0,
      today_logins: 0
    };
    
    function startAutoRefresh() {
      if (refreshTimer) clearInterval(refreshTimer);
      
      // Add visual indicator that auto-refresh is active
      const refreshBtn = document.querySelector(".refresh-btn");
      refreshBtn.classList.add('auto-refresh-active');
      
      refreshTimer = setInterval(() => {
        console.log('Auto-refreshing dashboard data from MongoDB...');
        
        // Fetch dashboard stats and compare with previous values
        fetch('/api/auth/dashboard-stats/')
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              const stats = data.stats;
              
              // Check for changes and highlight them
              highlightChanges('totalSessions', stats.total_sessions, previousStats.total_sessions);
              
              // Save current values for next comparison
              previousStats = {
                live_users: stats.live_users,
                total_users: stats.total_users,
                active_sessions: stats.active_sessions,
                today_logins: stats.today_logins
              };
              
              // Update all stats
              refreshDashboardStats();
              // Also refresh pending questions count specifically
              refreshPendingQuestionsCount();
            }
          });
          
        // Refresh sessions table without showing loading state
        refreshUserSessionsQuietly();
      }, autoRefreshInterval);
    }
    
    // Highlight changes with animation
    function highlightChanges(elementId, newValue, oldValue) {
      if (newValue !== oldValue) {
        const element = document.getElementById(elementId);
        // Add highlight class
        element.classList.add('highlight-change');
        // Remove it after animation completes
        setTimeout(() => {
          element.classList.remove('highlight-change');
        }, 2000);
      }
    }
    
    // Refresh sessions without showing loading indicator
    function refreshUserSessionsQuietly() {
      const url = `/api/auth/sessions/?page=${currentPage}&per_page=${rowsPerPage}&status=${document.getElementById('statusFilter').value}&search=${document.getElementById('sessionSearch').value.trim()}`;
      
      fetch(url)
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const oldSessions = [...sessions]; // Copy current sessions
            sessions = data.sessions;
            
            // Only re-render if data has changed
            if (JSON.stringify(oldSessions) !== JSON.stringify(sessions)) {
              renderTable();
              updatePagination(data.pagination);
            }
          }
        })
        .catch(error => {
          console.error('Error in quiet refresh:', error);
        });
    }
    
    function stopAutoRefresh() {
      if (refreshTimer) {
        clearInterval(refreshTimer);
        refreshTimer = null;
      }
    }

    // Function to clean up search input styling
    function cleanSearchInput() {
      const searchInput = document.getElementById('sessionSearch');
      if (searchInput) {
        // Remove any unwanted background images or styles
        searchInput.style.backgroundImage = 'none';
        searchInput.style.background = '#ffffff';
        searchInput.style.backgroundRepeat = 'no-repeat';
        searchInput.style.backgroundSize = 'auto';
        searchInput.style.backgroundPosition = 'initial';
        searchInput.style.border = '1px solid #e2e8f0';
        searchInput.style.boxShadow = '0 1px 3px rgba(0, 0, 0, 0.1)';
        searchInput.style.cursor = 'text';
        searchInput.style.webkitAppearance = 'none';
        searchInput.style.mozAppearance = 'none';
        searchInput.style.appearance = 'none';
        searchInput.style.borderRadius = '25px';
        searchInput.style.padding = '14px 20px 14px 48px';
        searchInput.style.fontSize = '15px';
        searchInput.style.fontWeight = '400';
        searchInput.style.letterSpacing = '0.01em';
        searchInput.style.color = '#374151';
        searchInput.style.width = '350px';
      }
    }

    // Initial data load
    document.addEventListener('DOMContentLoaded', function() {
      // Clean up search input styling
      cleanSearchInput();
      
      // Fetch initial dashboard stats
      refreshDashboardStats();
      
      // Fetch initial user sessions
      fetchUserSessions(1);
      
      // Add cleanup button and auto-refresh toggle
      const sessionsHeader = document.querySelector('.section-header h3');
      if (sessionsHeader && sessionsHeader.textContent.trim() === 'User Login Sessions') {
        const parent = sessionsHeader.parentNode;
        
        // Add auto-refresh toggle button
        const autoRefreshToggle = document.createElement('button');
        autoRefreshToggle.id = 'autoRefreshToggle';
        autoRefreshToggle.className = 'btn btn-success';
        autoRefreshToggle.style.marginLeft = '10px';
        autoRefreshToggle.textContent = 'Disable Auto-Refresh';
        autoRefreshToggle.onclick = toggleAutoRefresh;
        parent.appendChild(autoRefreshToggle);
        
        // Add cleanup button
        const cleanupButton = document.createElement('button');
        cleanupButton.className = 'btn';
        cleanupButton.style.marginLeft = '10px';
        cleanupButton.textContent = 'Cleanup Old Sessions';
        cleanupButton.onclick = cleanupOldSessions;
        parent.appendChild(cleanupButton);
      }
      
      // Start auto refresh
      startAutoRefresh();
      
      // Periodically clean up search input styling to prevent external interference
      setInterval(cleanSearchInput, 1000);
    });

    // Add event listener for search input to handle Enter key
    document.addEventListener('DOMContentLoaded', function() {
      const searchInput = document.getElementById('sessionSearch');
      if (searchInput) {
        searchInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
            searchSessions();
          }
        });
      }
    });

    // Feedback Approval Functions
    let pendingFeedback = [];
    let currentUserRole = null;
    
    // Function to get current user role
    function getCurrentUserRole() {
      return fetch('/api/auth/check/')
        .then(response => response.json())
        .then(data => {
          if (data.success && data.authenticated) {
            currentUserRole = data.user.role;
            return data.user.role;
          } else {
            currentUserRole = null;
            return null;
          }
        })
        .catch(error => {
          console.error('Error getting user role:', error);
          currentUserRole = null;
          return null;
        });
    }
    
    // Function to check if user can approve feedback (only admins)
    function canApproveFeedback() {
      return currentUserRole === 'admin';
    }
    
    // Function to update feedback action buttons visibility
    function updateFeedbackActionButtons() {
      const actionButtons = document.getElementById('feedbackActionButtons');
      if (!actionButtons) return;
      
      if (canApproveFeedback()) {
        // Show all buttons for admins
        actionButtons.style.display = 'flex';
        actionButtons.innerHTML = `
          <button class="btn btn-success" onclick="approveAllPending()">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 5px;">
              <path d="M9 12l2 2 4-4"></path>
              <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
              <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
              <path d="M13 12h3a2 2 0 0 1 2 2v1"></path>
              <path d="M13 12H9a2 2 0 0 0-2 2v1"></path>
              <path d="M13 12v-2a2 2 0 0 0-2-2H9"></path>
            </svg>
            Approve All
          </button>
          <button class="btn" onclick="refreshPendingFeedback()">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 5px;">
              <path d="M21 2v6h-6"></path>
              <path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path>
              <path d="M3 22v-6h6"></path>
              <path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
            </svg>
            Refresh
          </button>
        `;
      } else {
        // Show only refresh button for managers
        actionButtons.style.display = 'flex';
        actionButtons.innerHTML = `
          <button class="btn" onclick="refreshPendingFeedback()">
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 5px;">
              <path d="M21 2v6h-6"></path>
              <path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path>
              <path d="M3 22v-6h6"></path>
              <path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
            </svg>
            Refresh
          </button>
          <div style="color: #6b7280; font-size: 14px; font-style: italic; display: flex; align-items: center; margin-left: 10px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 5px;">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
            Manager View - Admin approval required
          </div>
        `;
      }
    }
    
    function fetchPendingFeedback() {
      const container = document.getElementById('pendingFeedbackContainer');
      container.innerHTML = '<div style="text-align: center; padding: 30px;">Loading pending feedback...</div>';
      
      // Get user role first, then fetch feedback
      getCurrentUserRole().then(() => {
        updateFeedbackActionButtons();
        
        fetch('/api/admin/contributions/?status=pending&per_page=50')
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          if (data.success) {
            pendingFeedback = data.contributions || [];
            renderPendingFeedback();
            updatePendingCount();
          } else {
            console.error('Error fetching pending feedback:', data.error);
            container.innerHTML = `
              <div class="feedback-empty-state">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="12" y1="8" x2="12" y2="12"></line>
                  <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
                <h4>Error Loading Feedback</h4>
                <p>${data.error || 'An unknown error occurred. Please try again.'}</p>
              </div>
            `;
          }
        })
        .catch(error => {
          console.error('Error fetching pending feedback:', error);
          container.innerHTML = `
            <div class="feedback-empty-state">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
              </svg>
              <h4>Connection Error</h4>
              <p>Could not connect to the server. Please check your connection and try again.</p>
            </div>
          `;
        });
      });
    }
    
    function renderPendingFeedback() {
      const container = document.getElementById('pendingFeedbackContainer');
      
      if (!pendingFeedback || pendingFeedback.length === 0) {
        container.innerHTML = `
          <div class="feedback-empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0z"></path>
              <path d="M9 10h.01"></path><path d="M15 10h.01"></path>
              <path d="M9.5 15.5c.82.82 2.13.97 3.5 1 1.33-.03 2.67-.18 3.5-1"></path>
            </svg>
            <h4>No Pending Feedback</h4>
            <p>All feedback has been reviewed. Great job!</p>
          </div>
        `;
        return;
      }
      
      let html = '';
      pendingFeedback.forEach(feedback => {
        const timestamp = formatDateTime(feedback.timestamp);
        const userInfo = feedback.user_email || feedback.user_id || 'Anonymous';
        
        html += `
          <div class="feedback-item" id="feedback-${feedback.id}">
            <div class="feedback-header">
              <div class="feedback-meta">
                <div class="feedback-user">${userInfo}</div>
                <div class="feedback-timestamp">${timestamp}</div>
              </div>
              <span class="feedback-type ${feedback.improvement_type || 'enhancement'}">${feedback.improvement_type || 'enhancement'}</span>
            </div>
            
            <div class="feedback-question">
              <h4>Question:</h4>
              <p>${feedback.question || 'No question provided'}</p>
            </div>
            
            <div class="feedback-answer">
              <h4>Answer:</h4>
              <p>${feedback.answer || 'No answer provided'}</p>
            </div>
            
            <div class="feedback-actions">
              ${canApproveFeedback() ? `
                <button class="btn btn-approve" onclick="approveFeedback('${feedback.id}')">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 5px;">
                    <path d="M9 12l2 2 4-4"></path>
                  </svg>
                  Approve
                </button>
                <button class="btn btn-reject" onclick="rejectFeedback('${feedback.id}')">
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 5px;">
                    <path d="M18 6L6 18"></path>
                    <path d="M6 6l12 12"></path>
                  </svg>
                  Reject
                </button>
              ` : `
                <div class="manager-view-only">
                  <span style="color: #6b7280; font-size: 14px; font-style: italic;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 5px; vertical-align: middle;">
                      <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                    </svg>
                    View Only - Admin approval required
                  </span>
                </div>
              `}
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }
    
    function approveFeedback(contributionId) {
      // Check if user can approve feedback
      if (!canApproveFeedback()) {
        showNotification('Only administrators can approve feedback.', 'error');
        return;
      }
      
      if (!confirm('Are you sure you want to approve this feedback?')) {
        return;
      }
      
      fetch('/api/admin/contributions/approve/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          contribution_id: contributionId,
          action: 'approve'
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Remove the approved feedback from the list
          pendingFeedback = pendingFeedback.filter(f => f.id !== contributionId);
          renderPendingFeedback();
          updatePendingCount();
          
          // Show success message
          showNotification('Feedback approved successfully!', 'success');
          
          // Refresh dashboard stats and pending questions count
          refreshDashboardStats();
          refreshPendingQuestionsCount();
        } else {
          console.error('Error approving feedback:', data.error);
          showNotification('Error approving feedback: ' + (data.error || 'Unknown error'), 'error');
        }
      })
      .catch(error => {
        console.error('Error approving feedback:', error);
        showNotification('Error approving feedback. Please try again.', 'error');
      });
    }
    
    function rejectFeedback(contributionId) {
      // Check if user can approve feedback
      if (!canApproveFeedback()) {
        showNotification('Only administrators can reject feedback.', 'error');
        return;
      }
      
      if (!confirm('Are you sure you want to reject this feedback?')) {
        return;
      }
      
      fetch('/api/admin/contributions/approve/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          contribution_id: contributionId,
          action: 'reject'
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Remove the rejected feedback from the list
          pendingFeedback = pendingFeedback.filter(f => f.id !== contributionId);
          renderPendingFeedback();
          updatePendingCount();
          
          // Show success message
          showNotification('Feedback rejected successfully!', 'success');
          
          // Refresh dashboard stats and pending questions count
          refreshDashboardStats();
          refreshPendingQuestionsCount();
        } else {
          console.error('Error rejecting feedback:', data.error);
          showNotification('Error rejecting feedback: ' + (data.error || 'Unknown error'), 'error');
        }
      })
      .catch(error => {
        console.error('Error rejecting feedback:', error);
        showNotification('Error rejecting feedback. Please try again.', 'error');
      });
    }
    
    function approveAllPending() {
      // Check if user can approve feedback
      if (!canApproveFeedback()) {
        showNotification('Only administrators can approve feedback.', 'error');
        return;
      }
      
      if (!pendingFeedback || pendingFeedback.length === 0) {
        showNotification('No pending feedback to approve.', 'info');
        return;
      }
      
      if (!confirm(`Are you sure you want to approve all ${pendingFeedback.length} pending feedback items?`)) {
        return;
      }
      
      const contributionIds = pendingFeedback.map(f => f.id);
      
      fetch('/api/admin/contributions/bulk-approve/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          contribution_ids: contributionIds,
          action: 'approve'
        })
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Clear the pending feedback list
          pendingFeedback = [];
          renderPendingFeedback();
          updatePendingCount();
          
          // Show success message
          showNotification(`Successfully approved ${data.approved_count || contributionIds.length} feedback items!`, 'success');
          
          // Refresh dashboard stats and pending questions count
          refreshDashboardStats();
          refreshPendingQuestionsCount();
        } else {
          console.error('Error bulk approving feedback:', data.error);
          showNotification('Error approving feedback: ' + (data.error || 'Unknown error'), 'error');
        }
      })
      .catch(error => {
        console.error('Error bulk approving feedback:', error);
        showNotification('Error approving feedback. Please try again.', 'error');
      });
    }
    
    function refreshPendingFeedback() {
      fetchPendingFeedback();
    }
    
    function updatePendingCount() {
      const count = pendingFeedback ? pendingFeedback.length : 0;
      const countElement = document.getElementById('pendingCount');
      if (countElement) {
        countElement.textContent = count;
        // Hide the badge if count is 0
        if (count === 0) {
          countElement.style.display = 'none';
        } else {
          countElement.style.display = 'inline-block';
        }
      }
      
      // Also update the pending questions card
      const pendingQuestionsElement = document.getElementById('pendingQuestionsCount');
      if (pendingQuestionsElement) {
        pendingQuestionsElement.textContent = count;
      }
    }
    
    // Function to refresh pending questions count specifically
    function refreshPendingQuestionsCount() {
      fetch('/api/auth/dashboard-stats/')
        .then(response => response.json())
        .then(data => {
          if (data.success && data.stats.pending_questions !== undefined) {
            const pendingQuestionsElement = document.getElementById('pendingQuestionsCount');
            if (pendingQuestionsElement) {
              pendingQuestionsElement.textContent = data.stats.pending_questions;
            }
          }
        })
        .catch(error => {
          console.error('Error refreshing pending questions count:', error);
        });
    }
    
    function showNotification(message, type = 'info') {
      // Create notification element
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 8px;
        color: white;
        font-weight: 500;
        z-index: 10000;
        max-width: 400px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transform: translateX(100%);
        transition: transform 0.3s ease;
      `;
      
      // Set background color based on type
      switch (type) {
        case 'success':
          notification.style.backgroundColor = '#10b981';
          break;
        case 'error':
          notification.style.backgroundColor = '#ef4444';
          break;
        case 'warning':
          notification.style.backgroundColor = '#f59e0b';
          break;
        default:
          notification.style.backgroundColor = '#3b82f6';
      }
      
      notification.textContent = message;
      document.body.appendChild(notification);
      
      // Animate in
      setTimeout(() => {
        notification.style.transform = 'translateX(0)';
      }, 100);
      
      // Remove after 4 seconds
      setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 300);
      }, 4000);
    }
    
    // Update the showTab function to handle the new feedback approval tab
    function showTab(tabId) {
      document.querySelectorAll(".tab-content").forEach(tab => tab.classList.remove("active"));
      document.querySelectorAll(".tab-btn").forEach(btn => btn.classList.remove("active"));
      document.getElementById(tabId).classList.add("active");
      event.target.classList.add("active");
      
      // Load feedback data when switching to feedback approval tab
      if (tabId === 'feedbackApproval') {
        fetchPendingFeedback();
      }
    }

    // Add User Modal Functions
    let selectedRole = 'user'; // Default role

    function openAddUserModal() {
      const modal = document.getElementById('addUserModal');
      modal.classList.add('active');
      document.body.style.overflow = 'hidden'; // Prevent background scrolling
      
      // Reset form
      document.getElementById('addUserForm').reset();
      selectedRole = 'user';
      updateRoleSelection();
    }

    function closeAddUserModal() {
      const modal = document.getElementById('addUserModal');
      modal.classList.remove('active');
      document.body.style.overflow = ''; // Restore scrolling
      
      // Reset form
      document.getElementById('addUserForm').reset();
      selectedRole = 'user';
      updateRoleSelection();
    }

    function selectRole(role) {
      selectedRole = role;
      updateRoleSelection();
    }

    function updateRoleSelection() {
      document.querySelectorAll('.role-option').forEach(option => {
        option.classList.remove('selected');
      });
      document.querySelector(`[data-role="${selectedRole}"]`).classList.add('selected');
    }

    // Handle form submission
    document.getElementById('addUserForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = {
        name: document.getElementById('userName').value.trim(),
        email: document.getElementById('userEmail').value.trim(),
        password: document.getElementById('userPassword').value,
        role: selectedRole
      };
      
      // Validate form data
      if (!formData.name || !formData.email || !formData.password) {
        showNotification('Please fill in all required fields.', 'error');
        return;
      }
      
      if (formData.password.length < 6) {
        showNotification('Password must be at least 6 characters long.', 'error');
        return;
      }
      
      // Validate email format
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(formData.email)) {
        showNotification('Please enter a valid email address.', 'error');
        return;
      }
      
      // Disable submit button and show loading
      const submitBtn = document.getElementById('createUserBtn');
      const originalText = submitBtn.textContent;
      submitBtn.disabled = true;
      submitBtn.innerHTML = 'Creating...';
      
      // Send request to create user
      fetch('/api/auth/create-user/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showNotification(`User "${formData.name}" created successfully with ${selectedRole} role!`, 'success');
          closeAddUserModal();
          
          // Refresh the dashboard stats and user lists
          refreshDashboardStats();
          
          // If we're on the new users tab, refresh it
          if (document.getElementById('newUsers').classList.contains('active')) {
            // The dashboard stats refresh will update the new users count
            // We could also add a specific refresh for the new users list here
          }
        } else {
          console.error('Error creating user:', data.error);
          showNotification('Error creating user: ' + (data.error || 'Unknown error'), 'error');
        }
      })
      .catch(error => {
        console.error('Error creating user:', error);
        showNotification('Error creating user. Please try again.', 'error');
      })
      .finally(() => {
        // Re-enable submit button
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      });
    });

    // Close modal when clicking outside
    document.getElementById('addUserModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeAddUserModal();
      }
    });

    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && document.getElementById('addUserModal').classList.contains('active')) {
        closeAddUserModal();
      }
    });

    // Home function
    function goHome() {
      // Show loading state
      const homeBtn = document.querySelector('.home-btn');
      const originalContent = homeBtn.innerHTML;
      homeBtn.disabled = true;
      homeBtn.innerHTML = 'Loading...';
      
      // Redirect to home page
      setTimeout(() => {
        window.location.href = '/home';
      }, 500);
    }

    // Logout function
    function logout() {
      if (!confirm('Are you sure you want to logout?')) {
        return;
      }
      
      // Show loading state
      const logoutBtn = document.querySelector('.logout-btn');
      const originalContent = logoutBtn.innerHTML;
      logoutBtn.disabled = true;
      logoutBtn.innerHTML = 'Logging out...';
      
      fetch('/api/auth/logout/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          showNotification('Logged out successfully!', 'success');
          // Redirect to login page after a short delay
          setTimeout(() => {
            window.location.href = '/login/';
          }, 1000);
        } else {
          console.error('Error logging out:', data.error);
          showNotification('Error logging out: ' + (data.error || 'Unknown error'), 'error');
          // Reset button state
          logoutBtn.disabled = false;
          logoutBtn.innerHTML = originalContent;
        }
      })
      .catch(error => {
        console.error('Error logging out:', error);
        showNotification('Error logging out. Please try again.', 'error');
        // Reset button state
        logoutBtn.disabled = false;
        logoutBtn.innerHTML = originalContent;
      });
    }
  </script>
</body>
</html>
